
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Run inference on the entire dataset &#8212; Course Notebooks Test</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom_hide.css?v=af9667c8" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'courses/01_examples/output/01_Ray_Data_batch_inference_06';</script>
    <script src="../../../_static/custom_toggle.js?v=1235ef5b"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Data Processing with Ray Data" href="02_Ray_Data_data_processing_01.html" />
    <link rel="prev" title="Create a batch data and call the model" href="01_Ray_Data_batch_inference_05.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Course Notebooks Test</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    Ray Enablement Content
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Developer Intro to Ray</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00_Intro_Ray_Core_Basics_01.html">Introduction to Ray Core: Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00_Intro_Ray_Core_Basics_02.html">0. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00_Intro_Ray_Core_Basics_03.html">1. Creating Remote Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00_Intro_Ray_Core_Basics_04.html">2. Executing Remote Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00_Intro_Ray_Core_Basics_05.html">4. Putting It All Together</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00a_Intro_Ray_Core_Advancement_01.html">Introduction to Ray Core (Advancement): Object store, Tasks, Actors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00a_Intro_Ray_Core_Advancement_02.html">1. Object store</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00a_Intro_Ray_Core_Advancement_03.html">2. Chaining Tasks and Passing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00a_Intro_Ray_Core_Advancement_04.html">3. Task retries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00a_Intro_Ray_Core_Advancement_05.html">4. Task Runtime Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00a_Intro_Ray_Core_Advancement_06.html">5. Resource allocation and management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00a_Intro_Ray_Core_Advancement_07.html">6. Nested Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00a_Intro_Ray_Core_Advancement_08.html">7. Pattern: Pipeline data processing and waiting for results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/00a_Intro_Ray_Core_Advancement_09.html">8. Ray Actors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/01_Intro_Ray_AI_Libs_Overview_01.html">Introduction to the Ray AI Libraries: An example of using Ray data, Ray Train, Ray Tune, Ray Serve to implement a XGBoost regression model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/01_Intro_Ray_AI_Libs_Overview_02.html">1. Overview of the Ray AI Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/01_Intro_Ray_AI_Libs_Overview_03.html">2. Quick end-to-end example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/02a_Intro_Ray_Train_with_PyTorch_01.html">Introduction to Ray Train + PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/02a_Intro_Ray_Train_with_PyTorch_02.html">1. When to use Ray Train</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/02a_Intro_Ray_Train_with_PyTorch_03.html">2. Single GPU Training with PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/02a_Intro_Ray_Train_with_PyTorch_04.html">3. Distributed Data Parallel Training with Ray Train and PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/02b_Intro_Ray_Train_with_PyTorch_Lightning_01.html">Introduction to Ray Train: Ray Train + PyTorch Lightning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/02b_Intro_Ray_Train_with_PyTorch_Lightning_02.html">1. When to use Ray Train</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/02b_Intro_Ray_Train_with_PyTorch_Lightning_03.html">2. Single GPU Training with PyTorch Lightning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/02b_Intro_Ray_Train_with_PyTorch_Lightning_04.html">3. Distributed Training with Ray Train and PyTorch Lightning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/02b_Intro_Ray_Train_with_PyTorch_Lightning_05.html">4. Ray Train in Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/03_Intro_Ray_Tune_01.html">Introduction to Ray Tune</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/03_Intro_Ray_Tune_02.html">1. Loading the data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/03_Intro_Ray_Tune_03.html">2. Starting out with vanilla PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/03_Intro_Ray_Tune_04.html">3. Hyperparameter tuning with Ray Tune</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/03_Intro_Ray_Tune_05.html">4. Ray Tune in Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04a_Intro_Ray_Data_Industry_Landscape_01.html">Introduction to Ray Data: Industry Landscape</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04a_Intro_Ray_Data_Industry_Landscape_02.html">The Compute Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04a_Intro_Ray_Data_Industry_Landscape_03.html">The Orchestration Layer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04a_Intro_Ray_Data_Industry_Landscape_04.html">Distributed Computing Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04a_Intro_Ray_Data_Industry_Landscape_05.html">Data Processing with Ray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04a_Intro_Ray_Data_Industry_Landscape_06.html">Ray Serve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04b_Intro_Ray_Data_Structured_01.html">Introduction to Ray Data: Ray Data + Structured Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04b_Intro_Ray_Data_Structured_02.html">0. What is Ray Data?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04b_Intro_Ray_Data_Structured_03.html">2. Loading Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04b_Intro_Ray_Data_Structured_04.html">3. Transforming Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04b_Intro_Ray_Data_Structured_05.html">4. Writing Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04b_Intro_Ray_Data_Structured_06.html">5. Data Operations: Shuffling, Grouping and Aggregation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04b_Intro_Ray_Data_Structured_07.html">6. When to use Ray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04c_Intro_Ray_Data_Unstructured_01.html">Intro to Ray Data:  Ray Data + Unstructured Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04c_Intro_Ray_Data_Unstructured_02.html">1. When to Consider Ray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04c_Intro_Ray_Data_Unstructured_03.html">2. How to work with Ray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04c_Intro_Ray_Data_Unstructured_04.html">3. Loading data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04c_Intro_Ray_Data_Unstructured_05.html">3. Lazy execution mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04c_Intro_Ray_Data_Unstructured_06.html">4. Transforming data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04c_Intro_Ray_Data_Unstructured_07.html">5. Stateful transformations with Ray Actors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04c_Intro_Ray_Data_Unstructured_08.html">6. Materializing data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04c_Intro_Ray_Data_Unstructured_09.html">7. Data Operations: grouping, aggregation, and shuffling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04c_Intro_Ray_Data_Unstructured_10.html">8. Persisting data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/04c_Intro_Ray_Data_Unstructured_11.html">9. Ray Data in production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/05_Intro_Ray_Serve_PyTorch_01.html">Introduction to Ray Serve with PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/05_Intro_Ray_Serve_PyTorch_02.html">1. When to Consider Ray Serve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/05_Intro_Ray_Serve_PyTorch_03.html">2. Overview of Ray Serve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/05_Intro_Ray_Serve_PyTorch_04.html">3. Implement an image classification service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/05_Intro_Ray_Serve_PyTorch_05.html">4. Development workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_Developer_Intro_to_Ray/output/README_01.html">Introduction to Ray: Developer</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">01 Examples</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_Ray_Data_batch_inference_01.html">Batch Inference with Ray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_Ray_Data_batch_inference_02.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_Ray_Data_batch_inference_03.html">Load a dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_Ray_Data_batch_inference_04.html">Batch Inference Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_Ray_Data_batch_inference_05.html">Create a batch data and call the model</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Run inference on the entire dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_Ray_Data_data_processing_01.html">Data Processing with Ray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_Ray_Data_data_processing_02.html">Library Imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_Ray_Data_data_processing_03.html">Convert to Ray Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_Ray_Data_data_processing_04.html">Filter Ray Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_Ray_Data_data_processing_05.html">Join Two Ray Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_Ray_Data_data_processing_06.html">Preprocessing with a Tokenizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_Ray_Serve_online_serving_01.html">Online Model Serving with Ray Serve</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_Ray_Serve_online_serving_02.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_Ray_Serve_online_serving_03.html">FastAPI webservice and deploy a model</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_Ray_Serve_online_serving_04.html">Simulate Client: Send test requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_Ray_Train_distributed_training_01.html">Distributed training with Ray Train, PyTorch and Hugging Face</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_Ray_Train_distributed_training_02.html">1. Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_Ray_Train_distributed_training_03.html">3. Metrics Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_Ray_Train_distributed_training_04.html">4. Training function per worker</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_Ray_Train_distributed_training_05.html">5. Main Training Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_Ray_Train_distributed_training_06.html">6. Start Training</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Anyscale 101</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../anyscale_101/output/101_anyscale_intro_jobs_01.html">Content Used</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../anyscale_101/output/101_anyscale_intro_jobs_02.html">Part 1. Creating and Submitting your first job</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../anyscale_101/output/101_anyscale_intro_jobs_03.html">Part 2. Automation and Scheduling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../anyscale_101/output/101_anyscale_intro_services_01.html">Sources</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../anyscale_101/output/101_anyscale_intro_services_02.html">Part 1: Starting your first Anyscale Service</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Ray 101</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/1_AI_Libs_Intro_01.html">Introduction to the Ray AI Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/1_AI_Libs_Intro_02.html">1. Overview of the Ray AI Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/1_AI_Libs_Intro_03.html">2. End-to-end example: predicting taxi tips in New York</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/1_AI_Libs_Intro_04.html">3. Running an experiment with Ray AI libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/2_Intro_Train_01.html">Introduction to Ray Train</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/2_Intro_Train_02.html">1. PyTorch introductory example (single GPU)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/2_Intro_Train_03.html">2. Distributed Data Parallel Training with Ray Train and PyTorch (multiple GPUs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/2_Intro_Train_04.html">3. Overview of the training loop in Ray Train</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/2_Intro_Train_05.html">4. Migrating the model and dataset to Ray Train</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/2_Intro_Train_06.html">5. Reporting checkpoints and metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/2_Intro_Train_07.html">6. Launching the distributed training job</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/2_Intro_Train_08.html">7. Accessing the training results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/2_Intro_Train_09.html">8. Ray Train in Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/3_Intro_Tune_01.html">Intro to Ray Tune</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/3_Intro_Tune_02.html">1. Loading and visualizing data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/3_Intro_Tune_03.html">2. Setting up a PyTorch model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/3_Intro_Tune_04.html">3. Introduction to Ray Tune</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/3_Intro_Tune_05.html">4. Diving deeper into Ray Tune concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/3_Intro_Tune_06.html">5. Hyperparameter tuning the PyTorch model using Ray Tune</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/4_Intro_Data_01.html">Intro to Ray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/4_Intro_Data_02.html">1. When to use Ray Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/4_Intro_Data_03.html">2. Loading Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/4_Intro_Data_04.html">3. Transforming Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/4_Intro_Data_05.html">4. Data Operations: Grouping, Aggregation, and Shuffling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/4_Intro_Data_06.html">5. Persisting Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/5_Intro_Serve_01.html">Intro to Ray Serve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/5_Intro_Serve_02.html">1. Overview of Ray Serve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/5_Intro_Serve_03.html">2. Implement an Classifier service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/5_Intro_Serve_04.html">3. Advanced features of Ray Serve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/5_Intro_Serve_05.html">4. Ray Serve in Production</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ray-101/output/5_Intro_Serve_06.html">Clean up</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/courses/01_examples/output/01_Ray_Data_batch_inference_06.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Run inference on the entire dataset</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#out-of-memory-errors">Out of memory errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shutdown-ray-cluster">Shutdown Ray cluster</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="run-inference-on-the-entire-dataset">
<h1>Run inference on the entire dataset<a class="headerlink" href="#run-inference-on-the-entire-dataset" title="Link to this heading">#</a></h1>
<p>Execute and materialize this dataset into object store memory. This operation will trigger execution of the lazy transformations performed on this dataset. The embedding model ‘TextEmbedder’ in map_batches() is called on the entire dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run inference on the entire dataset</span>
<span class="c1"># Note that this does not mutate the original Dataset.</span>
<span class="n">materialized_ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">materialize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "63b0ab43e93c4900a9008a1a130a1341", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "5e40789bd09d4aabbbd7305887843f4c", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "1271148a268b4d47a6b75e64c91ec165", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "a4245ae20232468e96b6aab8aaca4fd7", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># metadata after inference</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** Original dataset:&#39;</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">** Materialized dataset:&#39;</span><span class="p">,</span> <span class="n">materialized_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Original dataset: MapBatches(TextEmbedder)
+- Repartition
   +- Dataset(num_rows=45615, schema={text: string, label: int64})

** Materialized dataset: MaterializedDataset(
   num_blocks=2,
   num_rows=45615,
   schema={
      text: string,
      label: int64,
      embedding: numpy.ndarray(shape=(384,), dtype=float)
   }
)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show a few rows of the materialized dataset with embeddings</span>
<span class="n">materialized_ds</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "eb609a2f22cb4e11ac21828265a198b5", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "37cc4c88a3cc4bfeb6e4d12365ee8d41", "version_major": 2, "version_minor": 0}</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;text&#39;: &#39;&quot;QT @user In the original draft of the 7th book, Remus Lupin survived the Battle of Hogwarts. #HappyBirthdayRemusLupin&quot;&#39;, &#39;label&#39;: 2, &#39;embedding&#39;: array([-1.17218718e-01,  7.51002133e-02,  8.44237953e-03,  2.10537948e-02,
       -8.00926834e-02,  6.09376505e-02,  8.09841380e-02,  6.39745891e-02,
       -1.34842591e-02, -1.22891478e-02,  9.70130879e-03,  8.13238472e-02,
        1.59728657e-02, -6.84826868e-03, -7.90290013e-02, -2.23982316e-02,
       -5.93358018e-02,  4.27904241e-02, -5.25669474e-03, -4.10776436e-02,
       -3.37784477e-02, -2.12912727e-02,  1.09729558e-01,  2.08834168e-02,
        6.42482564e-02, -5.55025972e-02, -3.46165411e-02,  6.61124960e-02,
       -5.21334969e-02, -3.30999158e-02, -1.77784879e-02,  3.47602344e-03,
       -2.97606084e-02, -6.36240765e-02, -4.66033891e-02,  6.25401214e-02,
        2.89564747e-02, -5.32266051e-02,  5.21380231e-02, -1.88834351e-02,
       -3.40600796e-02,  1.02842702e-02, -2.32401919e-02,  6.98712543e-02,
        5.05110919e-02, -1.33760041e-02, -6.32564947e-02,  2.94806529e-02,
       -6.45845979e-02,  7.76715726e-02,  2.06234232e-02,  7.12174596e-03,
       -2.40456108e-02, -4.19275388e-02,  4.32918817e-02,  1.97234564e-02,
        6.78284839e-02, -5.84342591e-02,  6.50576949e-02, -6.35665376e-04,
       -9.23694149e-02,  6.70160577e-02,  1.61644816e-02,  8.81150190e-04,
       -1.06128380e-02, -1.53647423e-01, -6.23815991e-02,  1.25934454e-02,
       -1.15874708e-02, -3.37391533e-03, -1.45804777e-03, -1.68279577e-02,
        3.16142738e-02, -9.56896693e-03,  2.58824509e-02,  1.72043703e-02,
       -1.06465332e-02, -4.50892793e-03, -1.57877821e-02, -4.38858718e-02,
        4.12587933e-02, -1.05029851e-01, -9.40064341e-03, -1.93991698e-02,
        8.07769895e-02, -1.46954274e-02,  7.76875392e-03, -9.70078446e-03,
       -7.73954112e-03, -6.33768886e-02, -4.40336857e-03,  1.01402104e-02,
        6.79888725e-02,  6.40537590e-02,  3.94202918e-02,  4.05897461e-02,
       -5.73339425e-02, -1.31973000e-02, -1.77555919e-01,  1.75755769e-02,
        3.35890651e-02, -2.96707787e-02,  6.60929009e-02,  5.90833239e-02,
        7.71614686e-02, -4.89910729e-02, -1.19408388e-02, -2.27159020e-02,
       -5.01141734e-02, -1.46210968e-01, -6.56389399e-03, -1.15747452e-01,
        7.41516277e-02,  3.42241838e-04,  8.31499174e-02,  2.45558545e-02,
        1.50099332e-02,  1.08849846e-01, -5.23204021e-02, -7.37850042e-03,
        3.49425897e-02,  8.54113623e-02, -9.36829392e-03, -5.40084913e-02,
       -1.64574068e-02, -7.19670653e-02,  3.98440845e-03,  3.58003160e-33,
        4.58818898e-02, -1.07039157e-02, -7.70758316e-02,  8.17278847e-02,
       -2.80772168e-02,  7.00596860e-03,  5.23302741e-02, -3.55900936e-02,
       -2.84438897e-02, -5.47925606e-02, -4.97773625e-02, -2.41786465e-02,
        1.80584863e-02, -7.33728483e-02, -7.44769201e-02,  4.01951000e-02,
       -1.16273381e-01, -4.30478994e-03, -4.09788750e-02,  2.46128924e-02,
       -1.12685782e-03, -3.20175812e-02, -4.27514724e-02, -5.19986786e-02,
        4.28858958e-02,  4.66034375e-02,  3.08393911e-02,  6.15451038e-02,
        3.45387161e-02,  3.17677706e-02, -1.05951829e-02, -4.23053056e-02,
        4.84787306e-04, -2.49361154e-02, -8.93655512e-03, -2.25248020e-02,
       -5.19684739e-02, -1.04188204e-01,  1.68928802e-02,  4.78072055e-02,
       -5.54645248e-02,  1.28076579e-02, -1.21971425e-02, -7.01387227e-02,
       -2.46787928e-02,  7.94926137e-02,  2.89146360e-02,  1.02481507e-01,
        1.06039613e-01, -2.30980236e-02,  2.10956261e-02,  3.45463008e-02,
       -5.59060508e-03, -3.63363028e-02, -3.71677093e-02,  2.28330866e-03,
       -4.01646197e-02,  1.11712754e-01,  2.84649059e-02,  1.89326443e-02,
        2.30981060e-03,  6.20113872e-02, -1.37751494e-02,  2.03241184e-02,
       -2.80346647e-02, -7.75653571e-02, -4.14971709e-02, -7.20567256e-03,
       -4.97926176e-02,  2.63391770e-02, -5.86166140e-03, -2.06317782e-04,
        5.78927866e-04, -8.92704949e-02, -4.81969379e-02, -7.32145682e-02,
        4.31562141e-02,  5.28947487e-02, -9.46654081e-02, -7.99955577e-02,
        6.97478577e-02,  6.47439016e-03, -5.47678024e-02,  1.17145060e-03,
        6.50785267e-02, -6.31659403e-02,  3.60769555e-02, -1.34668782e-01,
        1.32890965e-03,  5.14443852e-02,  3.90151963e-02, -4.06383444e-03,
       -6.79656491e-02,  3.05412337e-02, -3.91437262e-02, -3.31172134e-33,
       -1.93256009e-02,  2.11085677e-02, -6.86359452e-03,  5.23793101e-02,
       -5.23960292e-02, -2.27106623e-02, -5.45928478e-02,  7.00129196e-02,
        1.41968962e-03, -5.32654747e-02,  3.35026570e-02,  5.39053045e-02,
       -4.56011016e-03,  1.05699580e-02,  1.02750473e-02, -1.76138058e-03,
       -4.18264270e-02,  7.87272584e-03,  9.69689246e-03, -2.13547181e-02,
       -2.16129310e-02, -2.17952654e-02, -8.20093006e-02, -2.54546804e-03,
        4.96112816e-02,  3.79144512e-02,  9.71367359e-02, -7.81605020e-02,
        2.14656349e-02, -5.85630648e-02,  1.49249397e-02, -8.17982033e-02,
       -7.98221380e-02, -4.16970104e-02,  6.06887527e-02, -2.16946062e-02,
        8.99340957e-02, -2.06241195e-04, -2.82704625e-02,  1.48663167e-02,
        9.76795331e-02,  4.07512747e-02,  3.91802080e-02,  1.84257627e-02,
        3.35833579e-02, -2.44072895e-03,  4.15428728e-02,  6.70849383e-02,
        1.69882979e-02,  5.21745682e-02, -2.44500265e-02, -6.58806413e-02,
        1.15585802e-02, -7.51119480e-02, -2.09318195e-02,  3.46736982e-03,
        3.93599756e-02, -9.12234001e-03,  2.78715137e-02, -3.19835320e-02,
       -7.81974494e-02, -2.90528610e-02,  3.26309279e-02,  3.06678507e-02,
        3.95409912e-02, -2.03319024e-02, -4.18165373e-03,  5.66712171e-02,
       -6.88231084e-03, -3.81209888e-02,  2.90659517e-02, -1.93396618e-03,
       -2.29473785e-02, -1.94511395e-02,  1.53534813e-02,  9.87687856e-02,
       -3.49257514e-02,  3.95493992e-02, -2.22867932e-02, -6.29297644e-03,
        8.33572224e-02,  2.73475703e-02, -3.66510823e-02,  3.77095975e-02,
        6.62408248e-02, -6.19172417e-02, -2.96917129e-02,  3.25294994e-02,
        3.17605399e-02, -6.35268092e-02,  5.86302094e-02,  9.55099240e-03,
        7.19797611e-02,  5.65288996e-04,  5.88193573e-02, -3.06202352e-08,
        4.70640138e-03,  1.02480531e-01, -2.98234466e-02, -9.26990714e-03,
        3.66888866e-02,  7.81677291e-02,  4.95807119e-02, -6.63496330e-02,
       -4.63559180e-02,  1.68990344e-01, -1.34740751e-02,  7.74639919e-02,
       -7.67530221e-03, -2.24219281e-02, -1.29715446e-02,  9.00719017e-02,
       -1.57175567e-02, -4.43267226e-02, -8.95755831e-03, -1.44299744e-02,
        3.72793153e-02,  1.30715715e-02,  9.86067504e-02,  2.01104600e-02,
       -4.95612733e-02,  6.32244647e-02,  5.00994138e-02, -4.25795130e-02,
       -4.42548003e-03, -4.18200418e-02,  6.43996522e-02,  1.28545947e-02,
       -1.49631714e-02, -6.33315668e-02, -6.71327189e-02,  6.92848936e-02,
       -4.39268537e-03,  5.62317707e-02,  6.82934299e-02,  2.83462293e-02,
       -5.08866049e-02,  5.43779554e-03,  8.86543170e-02,  1.91011913e-02,
       -5.92106171e-02, -5.94048835e-02, -1.15786707e-02, -5.75899668e-02,
       -1.15391724e-02, -5.88483773e-02, -6.32902160e-02, -6.89050034e-02,
        6.49331436e-02, -2.99487356e-02, -4.41985670e-03,  2.54450669e-03,
        2.28572544e-02,  4.88852262e-02,  3.76263633e-02, -6.22804798e-02,
        7.95309842e-02,  5.28628640e-02,  6.09668531e-02,  8.14268738e-02],
      dtype=float32)}
{&#39;text&#39;: &#39;&quot;Ben Smith / Smith (concussion) remains out of the lineup Thursday, Curtis #NHL #SJ&quot;&#39;, &#39;label&#39;: 1, &#39;embedding&#39;: array([-2.55613178e-02, -1.22277103e-02, -7.82985464e-02,  2.23083012e-02,
        4.47834991e-02,  9.60700288e-02,  6.89739510e-02,  1.91462375e-02,
        3.44326049e-02, -1.80058852e-02, -7.94921815e-02,  8.78439620e-02,
       -2.44877301e-02,  4.82736081e-02,  4.00641076e-02, -7.94008095e-03,
       -5.26009388e-02,  7.12939501e-02, -6.52135583e-03, -6.82709087e-03,
       -1.29825398e-01,  8.02508835e-03, -8.82670507e-02, -1.48856053e-02,
        5.56896329e-02,  6.38554320e-02, -1.19254841e-02, -2.13803817e-02,
       -8.43747482e-02,  1.26320729e-02, -4.74106744e-02, -1.50946071e-02,
        8.63529071e-02, -4.39660065e-02,  3.20312032e-03, -8.74198601e-03,
       -4.42857780e-02,  6.30582720e-02, -5.30618355e-02,  5.91205712e-03,
        3.80778313e-02,  4.53377999e-02, -5.43168001e-02, -2.31449399e-03,
        5.61808310e-02,  1.20103974e-02, -4.82929088e-02, -7.57502690e-02,
        5.07813133e-02,  6.22332841e-02,  3.17716263e-02, -7.45667797e-03,
        4.52154651e-02,  4.76346910e-02,  2.97699012e-02,  3.64353992e-02,
       -1.03162946e-02, -2.26502474e-02, -6.53998228e-03,  4.38563488e-02,
       -1.53381238e-02, -7.38687068e-02,  1.18025970e-02, -4.27902825e-02,
        3.20152864e-02,  1.69849765e-04, -7.02338964e-02, -2.94919703e-02,
       -5.24085984e-02,  5.06155156e-02,  5.58261052e-02,  4.48048115e-02,
       -9.27486494e-02, -2.99074054e-02, -1.43916206e-02,  9.60254669e-03,
        2.32722983e-03, -7.26314560e-02,  8.12841654e-02,  2.87622940e-02,
        3.61495838e-02, -7.20370263e-02, -3.91010717e-02,  4.62209135e-02,
        5.63077107e-02,  5.88136353e-02, -2.27219909e-02,  4.94449548e-02,
       -5.53754605e-02,  8.89227986e-02, -8.43940079e-02,  3.83486040e-02,
        1.23478852e-01, -1.62131321e-02,  5.37196398e-02,  1.14703774e-02,
       -1.28796948e-02, -3.82876396e-02, -9.97122377e-02,  6.26244992e-02,
        1.25175510e-02,  3.23107583e-03,  2.76067518e-02, -8.78041089e-02,
        1.04419766e-02, -1.30746688e-03, -2.71802861e-02, -3.36855166e-02,
        4.15072963e-03, -5.99537045e-02,  4.48855758e-02,  1.14159100e-01,
       -5.89613281e-02,  3.30517557e-03,  3.20716389e-02, -3.87823978e-03,
        2.39532143e-02,  7.92267558e-04,  6.68623075e-02, -4.79875319e-02,
        2.11493243e-02,  8.82634446e-02,  2.38798335e-02,  4.41922843e-02,
        1.60900429e-02,  5.62676229e-02, -1.37080820e-02, -1.52324782e-33,
        1.40510444e-02,  1.25912409e-02,  1.56041365e-02,  5.57393692e-02,
        2.67249476e-02, -4.11788076e-02,  1.36150215e-02, -8.49959813e-03,
       -4.08855490e-02, -6.99530393e-02, -2.27213278e-02, -1.71361454e-02,
        9.42177847e-02, -8.82237032e-02, -1.90656148e-02, -3.51617597e-02,
        5.87068461e-02, -1.54304842e-03,  3.76780378e-03, -5.22918031e-02,
       -5.45237213e-02, -1.76568236e-03, -7.63769671e-02,  3.08161136e-03,
       -3.69230062e-02, -2.68261507e-02, -1.76323075e-02, -6.73842654e-02,
       -3.03915609e-02,  1.09058516e-02, -5.56920916e-02,  1.28869668e-01,
        7.84609653e-03,  8.80600139e-02,  7.00087994e-02, -3.35481167e-02,
       -9.90392175e-03,  6.11897744e-02, -2.46281177e-02, -9.28131025e-03,
        3.00403815e-02,  1.66808441e-02, -9.37153175e-02, -1.46350823e-02,
       -5.96568063e-02,  1.21405767e-02,  2.86025219e-02,  7.83483610e-02,
        2.18932852e-02, -5.49808554e-02,  3.51315774e-02,  6.61210120e-02,
        1.81153491e-02,  2.04514116e-02, -9.43328887e-02,  1.73909385e-02,
        5.59438765e-02,  4.97128675e-03,  2.51865722e-02, -1.96423475e-03,
        1.33300245e-01,  1.53959617e-02, -8.91614705e-02,  8.85712914e-03,
       -2.07582638e-02, -4.13841531e-02, -7.87826851e-02, -1.19861914e-02,
       -4.14533243e-02, -1.92968845e-02,  2.61377022e-02,  5.39287962e-02,
       -9.38115362e-03,  6.85030222e-02, -5.84072098e-02,  1.24473451e-03,
       -6.05048873e-02,  1.36857450e-01, -3.39905545e-03,  3.11745796e-02,
        7.76972622e-02, -6.35873899e-02, -4.34449054e-02, -1.58614498e-02,
       -3.84016372e-02,  3.38910706e-03,  2.32756231e-02, -5.53193595e-03,
       -1.38496622e-01,  2.69974936e-02,  2.49307863e-02,  3.71107422e-02,
        5.30565623e-04, -1.60926636e-02, -3.14777484e-03, -2.76055871e-34,
       -9.78836194e-02, -1.46938870e-02, -7.27394149e-02,  2.06164196e-02,
        3.10279503e-02, -8.07614997e-02,  7.94474315e-03,  3.32296453e-02,
        7.23314434e-02, -3.07590961e-02,  6.15157820e-02, -4.93274853e-02,
       -8.39590132e-02,  3.49642932e-02,  4.63410094e-02, -1.90476887e-02,
       -8.16249922e-02,  7.04781413e-02, -5.39747020e-03, -8.58904049e-03,
        9.71276686e-02, -8.64927173e-02, -6.38451725e-02, -2.74092592e-02,
       -6.03620186e-02,  3.69485952e-02,  7.36873224e-02,  2.89384127e-02,
       -6.56188577e-02,  4.94507216e-02, -7.41920993e-02, -1.42943636e-02,
        1.66672035e-04, -9.95530374e-03, -4.00982723e-02,  3.37605290e-02,
       -5.95777296e-02,  6.70991046e-03, -1.57008413e-02,  3.73471044e-02,
        3.79455946e-02,  5.53716086e-02,  3.18707759e-03,  1.51786283e-01,
        7.76463524e-02,  1.42904809e-02,  5.78197911e-02,  4.46490431e-03,
       -1.10954670e-02,  3.20407227e-02, -5.73056117e-02, -7.25806283e-04,
       -7.94559568e-02,  3.97899076e-02, -4.93872128e-02, -1.19192507e-02,
       -1.98645657e-03, -7.47399181e-02, -5.22234142e-02, -1.06282867e-01,
       -9.44628939e-03,  4.59105931e-02,  1.49779003e-02, -1.83186028e-02,
        9.78474542e-02,  3.79409343e-02,  1.98250581e-02, -1.93877090e-02,
       -5.19630387e-02, -6.22458421e-02, -5.05403318e-02, -3.21796946e-02,
        7.79880509e-02, -5.00046369e-03, -4.84560393e-02,  1.87722724e-02,
       -4.44888324e-02,  2.35665385e-02,  1.78778227e-02,  2.74006203e-02,
       -1.57440994e-02, -3.61626707e-02, -6.27598614e-02,  5.92633970e-02,
        1.58189368e-02, -2.34323069e-02,  2.17458829e-02,  2.83414386e-02,
       -6.52647242e-02, -4.23069037e-02, -1.01103884e-04, -1.94980036e-02,
        1.46038486e-02,  8.76936167e-02, -8.81101489e-02, -2.34348310e-08,
       -5.31913936e-02, -3.84204574e-02, -1.30834863e-01, -3.89393270e-02,
        9.15531293e-02,  8.70207208e-04,  7.21508265e-02,  3.77374096e-03,
        9.15844142e-02,  3.65297012e-02, -3.70606668e-02,  1.32635012e-02,
       -2.73160497e-03, -4.00724374e-02,  4.21377383e-02,  4.44875658e-02,
       -9.84100178e-02, -3.10863163e-02, -1.36786141e-02, -5.65908886e-02,
       -1.04401015e-01,  1.89414667e-03, -1.74725649e-03,  3.48813944e-02,
        2.80134752e-02,  6.42856956e-02, -4.85674404e-02,  6.26258478e-02,
        3.54573391e-02, -1.47293536e-02,  1.23639209e-02,  6.23702966e-02,
        4.56662523e-03,  1.61783993e-02,  9.06857569e-03, -4.01875377e-02,
       -1.36868265e-02, -4.51042950e-02,  1.08593434e-01, -9.17549804e-02,
       -2.72664893e-02, -6.42662169e-03, -4.96078059e-02,  7.15247765e-02,
        6.12468980e-02, -2.39855982e-02,  3.41575071e-02,  3.28529142e-02,
       -6.83045536e-02, -1.24854468e-01, -1.72060728e-02, -2.08318681e-02,
        1.95717700e-02,  6.82900697e-02,  3.40240113e-02,  6.28125295e-02,
        8.68410710e-03, -5.08967713e-02, -2.17342269e-04, -5.02352677e-02,
       -3.67074795e-02,  6.09954223e-02, -1.23113478e-02,  7.49106100e-03],
      dtype=float32)}
{&#39;text&#39;: &#39;Sorry bout the stream last night I crashed out but will be on tonight for sure. Then back to Minecraft in pc tomorrow night.&#39;, &#39;label&#39;: 1, &#39;embedding&#39;: array([-9.28160176e-03, -4.14892137e-02,  1.45565206e-02, -8.35185423e-02,
        7.88125470e-02, -1.39421923e-02, -4.58531007e-02,  3.97312343e-02,
       -7.73005784e-02,  1.19767813e-02, -4.00974117e-02,  6.80779386e-03,
       -6.15553670e-02,  3.10526211e-02, -2.67168414e-03,  2.56718080e-02,
       -8.10807291e-03,  2.01351717e-02, -1.05955295e-01,  7.41280317e-02,
       -4.72918749e-02, -4.68044616e-02, -4.42471355e-02,  1.13586960e-02,
       -1.18926680e-02,  7.31019164e-03,  8.72505680e-02,  5.27818017e-02,
       -2.33023707e-02, -3.09640113e-02, -9.57536250e-02, -1.18500029e-03,
       -1.26816351e-02, -2.40409318e-02,  2.89740060e-02,  2.65101083e-02,
        2.42837034e-02, -2.03901269e-02,  1.64824829e-03, -2.51518283e-02,
        7.54621774e-02,  5.11016287e-02, -6.16848189e-03, -3.56115811e-02,
       -7.21600205e-02,  8.51503164e-02,  1.59831755e-02, -5.34999743e-02,
        6.00217544e-02,  1.03347346e-01, -5.25707304e-02, -5.24885803e-02,
        2.75378935e-02,  2.17306670e-02,  1.28086493e-03,  2.91938744e-02,
       -2.06012297e-02,  6.30638674e-02,  7.67096058e-02, -2.18252768e-03,
        5.29807210e-02, -5.36710434e-02, -1.47477984e-02,  3.15658525e-02,
        1.01958193e-01, -2.24984046e-02, -9.17503238e-03,  3.21776196e-02,
        3.12821269e-02, -2.82377563e-02, -3.95642184e-02,  2.62470581e-02,
       -5.04267104e-02, -5.34561165e-02, -9.26208720e-02,  4.50164117e-02,
        1.61173157e-02, -1.28749549e-01, -1.77606642e-02,  5.82819171e-02,
        3.07420641e-02, -9.28947702e-03, -8.07348490e-02, -3.60559933e-02,
       -6.85011083e-03, -1.41520910e-02, -1.73541475e-02,  1.04313433e-01,
        7.97910169e-02,  2.97468323e-02, -1.14019522e-02,  9.90668219e-03,
        7.12907687e-02,  1.58452298e-02, -2.38109175e-02,  1.05117615e-02,
        7.72602186e-02, -6.75087003e-03, -5.08386130e-03,  1.63008086e-02,
        8.83987024e-02,  5.79223316e-03,  1.43902507e-02,  2.57970206e-02,
        2.62782574e-02, -5.59260547e-02, -3.66871315e-03,  8.70502144e-02,
        6.40254933e-03, -6.49876371e-02, -3.90511677e-02,  4.14787792e-02,
        7.07005756e-03, -2.71599907e-02,  5.49026504e-02,  1.06359579e-01,
       -4.86110076e-02,  6.92230538e-02, -2.42604055e-02,  1.72232352e-02,
       -1.01544438e-02, -1.07735191e-02, -1.26948217e-02, -5.11058047e-02,
        9.76448804e-02,  6.84200376e-02,  2.25723777e-02,  6.43248991e-35,
        7.32454751e-03, -6.26351237e-02, -4.04127836e-02,  6.97651729e-02,
        1.08847059e-01, -9.73338448e-03,  7.00958297e-02,  1.52096841e-02,
       -3.87136489e-02, -2.70176884e-02,  2.95678936e-02, -5.12014441e-02,
       -5.13095595e-02, -4.07334603e-02, -8.59555081e-02, -3.13828215e-02,
        7.55923614e-02, -4.56688479e-02, -9.45596695e-02,  4.87503409e-02,
       -3.98070179e-02, -5.26156314e-02, -5.62014505e-02,  1.45803327e-02,
       -7.69655108e-02,  2.29535252e-02, -1.21584712e-02, -2.18899436e-02,
        3.46212946e-02,  2.07796153e-02, -6.07565679e-02, -7.80770779e-02,
       -2.63716504e-02,  1.81611199e-02,  4.50653918e-02, -2.36595646e-02,
       -1.03722222e-01, -1.41933542e-02, -1.13086134e-01, -5.26371822e-02,
        1.93267390e-02,  2.75361482e-02, -4.88547347e-02, -6.93108886e-02,
       -1.33832851e-02, -1.41709536e-01,  3.38281021e-02,  2.47783903e-02,
        2.21503563e-02, -2.30557770e-02, -1.72964428e-02,  8.39066431e-02,
        2.37764162e-03, -2.27935463e-02, -1.10879738e-03,  4.46190545e-03,
       -6.24192730e-02,  2.34613437e-02, -4.95128240e-03,  6.39796034e-02,
        2.01946776e-02,  5.57737350e-02,  7.97899440e-02, -1.58086956e-01,
        2.69690510e-02, -2.01505721e-02,  3.97603959e-02,  1.86763499e-02,
        5.12183236e-04, -5.84025085e-02,  2.22967193e-02,  2.96519734e-02,
        3.64042781e-02, -4.09158831e-03,  3.81992236e-02,  9.54230055e-02,
       -3.41169238e-02, -1.46371266e-02,  2.51320172e-02,  7.58155808e-02,
       -3.54291149e-03,  1.05031021e-02,  4.76404205e-02, -1.32373542e-01,
       -4.37142141e-02,  4.77830246e-02,  2.15556864e-02, -6.28415197e-02,
        2.90165711e-02,  2.52539432e-03, -1.19884178e-01,  1.67702921e-02,
        8.08926150e-02, -1.29964035e-02,  4.30540405e-02, -1.49187856e-33,
       -3.76389585e-02,  1.70480572e-02, -9.97973699e-03, -2.76702512e-02,
        3.40880044e-02, -4.40937243e-02,  5.09305708e-02,  8.44945610e-02,
       -4.93653901e-02, -5.67625724e-02, -7.82248098e-03, -9.26000811e-03,
       -1.28712449e-02,  2.40222309e-02, -4.32768166e-02, -1.10129036e-01,
       -1.34206163e-02,  2.51739728e-03,  3.32192443e-02,  2.78793629e-02,
       -5.87145798e-02, -3.75092961e-02, -1.92250460e-02,  1.93505753e-02,
        4.26429361e-02,  1.96230914e-02, -6.79288665e-03,  7.65683129e-02,
       -3.08306534e-02,  3.08888834e-02,  9.09694359e-02,  4.20587808e-02,
       -2.68863142e-02,  5.45977615e-02,  5.81750199e-02,  8.59733031e-04,
        7.85737485e-02, -2.00728178e-02,  1.43806068e-02, -2.88060308e-03,
        2.99445761e-04,  1.96223371e-02, -1.04279362e-01,  4.70483862e-02,
        3.43821533e-02,  5.97741865e-02,  2.01273207e-02,  1.25387060e-02,
       -2.16315296e-02, -3.37964366e-03,  5.47997355e-02,  1.73962507e-02,
        1.05964907e-01, -2.35189386e-02,  8.73528048e-02, -1.08117312e-01,
        1.01148352e-01, -2.31141504e-02, -1.67394597e-02, -5.98530062e-02,
       -1.05838008e-01, -1.03351809e-01, -3.96672040e-02,  4.51281480e-02,
        1.55635225e-02,  8.08900222e-02,  2.57156566e-02,  4.25258800e-02,
       -2.87305135e-02, -4.58301930e-03, -5.33827804e-02,  1.47896763e-02,
       -2.74435990e-02, -1.04760937e-02,  3.67200039e-02,  1.03974594e-02,
        5.51383309e-02,  2.80356482e-02, -3.77459675e-02,  1.33281359e-02,
        4.06659506e-02,  6.29792884e-02, -3.57226282e-02, -8.08423311e-02,
        1.12480514e-01, -6.56274483e-02,  8.19716156e-02,  8.39561000e-02,
       -1.01000227e-01, -5.75359203e-02, -2.35024523e-02,  2.04023737e-02,
       -3.35016027e-02,  2.55699139e-02,  5.16707636e-02, -2.47635157e-08,
       -3.07316985e-02, -3.44269560e-03, -4.59552705e-02,  1.04871886e-02,
        4.93218452e-02,  2.82714777e-02,  7.73386657e-03, -7.70623609e-02,
        1.47110615e-02,  4.44087312e-02, -2.66246349e-02, -8.97952076e-03,
       -2.92452052e-02,  4.84724203e-03,  2.41526775e-02, -8.97161290e-02,
       -5.31209707e-02, -3.75342406e-02,  1.25268223e-02, -5.02448604e-02,
        1.19601890e-01,  1.33688403e-02, -6.22192677e-03,  5.88282757e-02,
        5.99094741e-02,  6.88624009e-02,  5.57160601e-02,  6.46354072e-03,
       -5.55601753e-02, -4.85491417e-02, -5.22552105e-03,  2.33951919e-02,
        7.89891556e-02, -3.87155861e-02,  3.01616676e-02, -1.01347007e-02,
        2.88339034e-02, -7.21206143e-03,  2.96016713e-03,  6.87395632e-02,
        7.59349391e-03, -5.99006638e-02, -1.45630976e-02, -6.54685497e-02,
       -5.21637220e-03, -3.24615501e-02, -1.02316421e-02,  2.12832280e-02,
       -5.23694418e-02, -4.33163792e-02, -1.01848297e-01, -6.08562492e-02,
        2.72087287e-02, -1.84077434e-02,  1.33167297e-01, -5.71831726e-02,
        4.76900255e-03, -2.59980466e-02, -5.92608377e-02, -9.81385726e-03,
        8.45981687e-02,  7.17623755e-02, -6.87222108e-02, -1.50424745e-02],
      dtype=float32)}
</pre></div>
</div>
</div>
</div>
<section id="out-of-memory-errors">
<h2>Out of memory errors<a class="headerlink" href="#out-of-memory-errors" title="Link to this heading">#</a></h2>
<p>GPU (or MPS or CPU) memory has to keep the machine learning model and the batch of data in memory during the inference. If the batch_size is too large, it can run out of memory and throw out of memory errors. In that case, reduce the batch_size.</p>
</section>
<section id="shutdown-ray-cluster">
<h2>Shutdown Ray cluster<a class="headerlink" href="#shutdown-ray-cluster" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># avoids collisons with other notebooks running ray jobs on the same machine</span>
<span class="n">ray</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>This notebook demonstrates how to perform efficient batch inference on large datasets using Ray Data. It walks through loading a public dataset from Hugging Face, converting it into a Ray Dataset, and defining a callable class to load and apply a machine learning model (SentenceTransformer) for embedding text. The notebook shows how to use Ray Data’s <code class="docutils literal notranslate"><span class="pre">map_batches</span></code> API to process data in parallel batches, leveraging available CPUs or GPUs for high-throughput inference. It also covers best practices for scaling, handling memory constraints, and summarizes how Ray Data enables scalable, distributed batch inference for modern ML workflows.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./courses/01_examples/output"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="01_Ray_Data_batch_inference_05.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Create a batch data and call the model</p>
      </div>
    </a>
    <a class="right-next"
       href="02_Ray_Data_data_processing_01.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Data Processing with Ray Data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#out-of-memory-errors">Out of memory errors</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#shutdown-ray-cluster">Shutdown Ray cluster</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book community
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>